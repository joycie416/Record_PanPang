# ë ˆì½”ë“œíŒ¡íŒ¡ ğŸ­ [Record PanPang]

[ë©”ì¸í˜ì´ì§€] ![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-09-20 á„‹á…©á„’á…® 4 45 08](https://github.com/user-attachments/assets/6e929713-6ba0-4e00-b423-bd1f2cec40a2)

[ìƒì„¸í˜ì´ì§€] <img width="1224" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-09-20 á„‹á…©á„’á…® 4 13 01" src="https://github.com/user-attachments/assets/1d4c5324-ec12-4c0b-8e99-024fde72e82a">

[ì»¤ë®¤ë‹ˆí‹° í˜ì´ì§€] <img width="1105" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-09-22 á„‹á…©á„Œá…¥á†« 12 08 43" src="https://github.com/user-attachments/assets/a99ff3df-c371-4eb5-8d57-cff8567bd4d5">

[ì¹´í…Œê³ ë¦¬ í˜ì´ì§€] <img width="1224" alt="í™”ë©´ìº¡ì²˜_2024-09-20_192523" src="src/assets/í™”ë©´ìº¡ì²˜_2024-09-20_192523.png">

---

## íŒ€ ì†Œê°œ

[ë‚´ì¼ë°°ì›€ìº í”„] 2ì¡°

## ğŸ‘¨â€ğŸ« í”„ë¡œì íŠ¸ ì†Œê°œ

### ìŒì•…ì„ ê³µìœ í•˜ëŠ” í˜ì´ì§€

### ğŸš© í”„ë¡œì íŠ¸ ê°œìš”

- **í”„ë¡œì íŠ¸ëª…** &nbsp; :&nbsp; **Record PanPang**
- **ì§„í–‰ ê¸°ê°„** &nbsp;: &nbsp; **24.10.10 ~ 24.10.17**

---

### ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ íŒ€ì› ì†Œê°œ

|  ì†¡ì§„ìš°   |     ì´ë³´ì˜     |        ì •ìˆ˜í¬         |   ì¡°ì•„ì˜    |            ì¡°í•´ì¸            |
| :-------: | :------------: | :-------------------: | :---------: | :--------------------------: |
| **íŒ€ì›**  |    **íŒ€ì›**    |       **íŒ€ì›**        |  **íŒ€ì›**   |           **íŒ€ì¥**           |
| ëŒ“ê¸€ ì „ë°˜ | ìŒì•… ê²€ìƒ‰ ê¸°ëŠ¥ | ìŒì•… í”Œë ˆì´ì–´, ì¢‹ì•„ìš” | ê²Œì‹œê¸€ ì „ë°˜ | íšŒì›ê°€ì…/ë¡œê·¸ì¸, í”„ë¡œí•„ ìˆ˜ì • |

---

## ğŸ“š STACKS

<div align=Left>
<img src="https://img.shields.io/badge/react-61DAFB?style=for-the-badge&logo=react&logoColor=black">
<img src="https://img.shields.io/badge/html5-E34F26?style=for-the-badge&logo=html5&logoColor=white">
<img src="https://img.shields.io/badge/css-1572B6?style=for-the-badge&logo=css3&logoColor=white">
<img src="https://img.shields.io/badge/typescript-1572B6?style=for-the-badge&logo=typescript&logoColor=white">
<img src="https://img.shields.io/badge/next.js-000000?style=for-the-badge&logo=next.js&logoColor=white">
<img src="https://img.shields.io/badge/TailwindCss-06B6D4?style=for-the-badge&logo=java&logoColor=white">
<img src="https://img.shields.io/badge/github-181717?style=for-the-badge&logo=github&logoColor=white">
<img src="https://img.shields.io/badge/git-F05032?style=for-the-badge&logo=git&logoColor=white">
<img src="https://img.shields.io/badge/Notion-000000?style=for-the-badge&logo=Notion&logoColor=white">
<img src="https://img.shields.io/badge/VSCODE-007ACC?style=for-the-badge&logo=visualstudiocode&logoColor=white">
<img src="https://img.shields.io/badge/VERCEL-007ACC?style=for-the-badge&logo=VERCEL&logoColor=white">
<img src="https://img.shields.io/badge/SLACK-green?style=for-the-badge&logo=SLACK&logoColor=white">
</div>

---

## ì„¤ì¹˜ íŒ¨í‚¤ì§€

- í”„ë¡œì íŠ¸ ì„¸íŒ… : npx create-next-app@latest
  - tailwindcss í¬í•¨
  - ì‹¤í–‰ : yarn dev
- tanstack query ì„¤ì¹˜ : yarn add @tanstack/react-query
  - tailwind.config.js íŒŒì¼ ìƒì„± : npx tailwindcss init -p
- zustand ì„¤ì¹˜ : yarn add zustand
- zod ì„¤ì¹˜ : yarn add zod
- react-hook-form ì„¤ì¹˜ : yarn add react-hook-form @hookform/resolvers
- shadcn/ui(ìºëŸ¬ì…€ ë¼ì´ë¸ŒëŸ¬ë¦¬) : yarn add shadcn/ui
  - gray, cssVariables X

---

## âœ”ï¸ Code Convention

- ES Lint , prettier ì‚¬ìš©
- ì»´í¬ë„ŒíŠ¸ì¼ ê²½ìš°ì—ë§Œ .jsxí™•ì¥ì ì‚¬ìš©
- customHookì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš° : use + í•¨ìˆ˜ëª…
- Propsì˜ ê²½ìš°: on (onClick ë“±ë“±)
- í•¨ìˆ˜ì¸ ê²½ìš°: handle (handleClick ë“±ë“±)
- ìƒìˆ˜ : ëª¨ë‘ ëŒ€ë¬¸ì ìŠ¤ë„¤ì´í¬ ì¼€ì´ìŠ¤(snake_case) ì˜ˆì‹œ) SNAKE_CASE
- js(ë³€ìˆ˜, í•¨ìˆ˜, ì¸ìŠ¤í„´ìŠ¤) : ì¹´ë©œ ì¼€ì´ìŠ¤(camelCase) ì˜ˆì‹œ) const createMovie = [];
- css, html : ì¼€ë°¥ ì¼€ì´ìŠ¤(kebab-case) ì˜ˆì‹œ)Â `<div class="movie-items"></div>`
- image ëª… : ì¼€ë°¥ ì¼€ì´ìŠ¤(kebab-case) ì˜ˆì‹œ) movie-img.jpg
- ì£¼ì„ ìµœëŒ€í•œ í™œìš©í•˜ê¸° : í•´ë‹¹ ì½”ë“œ ì œëª©, ì„¤ëª… ê°„ë‹¨í•˜ê²Œ ì ì–´ë†“ê¸°
- ì•½ì¹­ì€ ë˜ë„ë¡ ì‚¬ìš©í•˜ì§€ ì•Šê¸°

## âœ”ï¸ Git Commit Convention

ì‘ì—… íƒ€ì… ì‘ì—…ë‚´ìš©

- update : í•´ë‹¹ íŒŒì¼ì— ìƒˆë¡œìš´ ê¸°ëŠ¥ì´ ìƒê¹€
- add : ì—†ë˜ íŒŒì¼ì„ ìƒì„±í•¨, ì´ˆê¸° ì„¸íŒ…
- bugfix : ë²„ê·¸ ìˆ˜ì •
- refactor : ì½”ë“œ ë¦¬íŒ©í† ë§
- fix : ì½”ë“œ ìˆ˜ì •
- move : íŒŒì¼ ì˜®ê¹€/ì •ë¦¬
- del : ê¸°ëŠ¥/íŒŒì¼ì„ ì‚­ì œ
- test : í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±
- style : css
- gitfix : gitignore ìˆ˜ì •
- script : package.json ë³€ê²½(npm ì„¤ì¹˜ ë“±)

## ğŸ—‚ï¸ ê¸°ëŠ¥ ì„¤ëª…

[íšŒì›ê°€ì…/ë¡œê·¸ì¸]

Supabase Authë¥¼ ì‚¬ìš©í•´ ê´€ë¦¬í–ˆìŠµë‹ˆë‹¤.

1. ìœ íš¨ì„± ê²€ì‚¬ - 1

ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ìœ„í•´ `zod`ì™€ `react-hook-form`ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ì¡´ì¬í•˜ëŠ” ì´ë©”ì¼ì€ ë³„ë„ì˜ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ í†µí•´ ì•Œë ¤ì¤ë‹ˆë‹¤.

```tsx
// ./src/components/auth/Auth

const AuthForm = () => {
  ...
  const schema =
    path === SIGN_UP
      ? z.object({
          email: z
            .string()
            .email({ message: "ì´ë©”ì¼ í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”" })
            .min(1, { message: "ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" }),
          password: z.string().min(6, "6ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”"),
          nickname: z.string().min(1, "ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.").max(10, "ìµœëŒ€ 10ì ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.")
        })
      : z.object({
          email: z.string().min(1, "ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"),
          password: z.string().min(1, "ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”")
        });
  ...
  const { register, handleSubmit, formState } = useForm({
    mode: "onChange", //'onBlur' : focusê°€ ì‚¬ë¼ì¡Œì„ ë•Œ
    defaultValues,
    resolver: zodResolver(schema)
  });
  ...
  return (
    <div className="container modal">
      <form onSubmit={handleSubmit(onSubmit)} className="p-4 flex flex-col items-center m-auto">
        <Input
          {...register("email")}
          placeholder="email"
          className={AUTH_CSS}
          onChange={() => setEmailMessage("")}
        />
        {formState.errors.email && <span className="text-sky-300 leading-tight">{formState.errors.email.message}</span>}
        {!!emailMessage && <span className="text-sky-300 leading-tight">{emailMessage}</span>}

        ...

      </form>
    </div>
  );
};
```

2. ìœ íš¨ì„± ê²€ì‚¬ - 2

`profiles` í…Œì´ë¸”ì— ì €ì¥ëœ `email`ì„ ë¶ˆëŸ¬ì™€ì„œ í•´ë‹¹ ì´ë©”ì¼ì´ ì¡´ì¬í•˜ëŠ” í™•ì¸í•©ë‹ˆë‹¤.

```tsx
// ./src/components/auth/Auth

const AuthForm = () => {
  ...
  const { register, handleSubmit, formState } = useForm({
    mode: "onChange", //'onBlur' : focusê°€ ì‚¬ë¼ì¡Œì„ ë•Œ
    defaultValues,
    resolver: zodResolver(schema)
  });
  ...
  const onSubmit = async (data: FieldValues) => {
    const emailData = await checkEmail(data.email);

    if (path === SIGN_UP) {
      if (emailData.length !== 0) {
        setEmailMessage("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ê³„ì •ì…ë‹ˆë‹¤.");
      } else {
        await signup({
          email: data.email,
          password: data.password,
          options: { data: { nickname: data.nickname, email: data.email, profile_img: "default" } }
        });
      }
    } else {
      if (emailData.length === 0) {
        setEmailMessage("ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê³„ì •ì…ë‹ˆë‹¤.");
      } else {
        await signin({ email: data.email, password: data.password });
      }
    }
  };
  ...
};
```

```tsx
// ./src/utils/supabase/client-actions.ts

export async function checkEmail(email: string) {
  const { data, error } = await supabase.from(PROFILES).select("email").eq("email", email);

  if (error) {
    console.error(error);
    return [];
  }

  return data;
}
```

---

[í”Œë ˆì´ì–´]

---

[ê²€ìƒ‰]

---

[ê²Œì‹œê¸€]

---

[ëŒ“ê¸€]

1. Supabaseë¥¼ ì´ìš©í•œ CRUD êµ¬í˜„

servert-action - ëŒ“ê¸€ ì¶”ê°€, ìˆ˜ì •, ì‚­ì œ

```jsx
// ëŒ“ê¸€ ì¶”ê°€
export async function addComment(content: string, postId: string) {
  const supabase = createClient();
  const {
    data: { user }
  } = await supabase.auth.getUser();

  if (!user) throw new Error("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");

  const { error } = await supabase.from("comments").insert([{ content, post_id: postId, user_id: user.id }]);

  if (error) throw new Error("ëŒ“ê¸€ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");

  revalidatePath(`/posts/${postId}`);
}

// ëŒ“ê¸€ ì‚­ì œ
export async function deleteComment(commentId: string) {
  const supabase = createClient();
  const {
    data: { user }
  } = await supabase.auth.getUser();

  if (!user) throw Error("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");

  const { error } = await supabase.from("comments").delete().eq("comment_id", commentId).eq("user_id", user.id);

  if (error) {
    throw new Error("ëŒ“ê¸€ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
  }
}

// ëŒ“ê¸€ ìˆ˜ì •
export async function updateComment(commentId: string, content: string) {
  const supabase = createClient();
  const {
    data: { user }
  } = await supabase.auth.getUser();

  if (!user) {
    throw new Error("ë¡œê·¸ì¸ í•´ì£¼ì„¸ìš”.");
  }
  const { error } = await supabase
    .from("comments")
    .update({ content })
    .eq("comment_id", commentId)
    .eq("user_id", user.id);

  if (error) {
    throw new Error("ëŒ“ê¸€ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
  }
  revalidatePath("/");
}
```

client-action - ëŒ“ê¸€ ì¡°íšŒ

```jsx
// ëŒ“ê¸€ ì¡°íšŒ
export async function fetchComment(postId: string): Promise<Comment[]> {
  const STORAGE = "profiles";

  const { data: comments, error: commentError } = await supabase
    .from("comments")
    .select("comment_id, content, user_id, created_at, update_at")
    .eq("post_id", postId)
    .order("created_at", { ascending: false }); // ìƒì„± ì‹œê°„ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬

  if (commentError) {
    console.error(commentError.message);
    throw new Error("ëŒ“ê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
  }
```

[ë§ˆì´í˜ì´ì§€]

ì‚¬ìš©ì ì •ë³´ì™€ ì‚¬ìš©ìê°€ ì‘ì„±í•œ ê²Œì‹œê¸€ê³¼ ëŒ“ê¸€, ì¢‹ì•„ìš”í•œ ê²Œì‹œê¸€ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

1. í”„ë¡œí•„ ìˆ˜ì • ê¸°ëŠ¥

`í”„ë¡œí•„ ìˆ˜ì •í•˜ê¸°` ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ëª¨ë‹¬ì°½ì„ í†µí•´ ì‚¬ìš©ì ì •ë³´ë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì‹¤ì‹œê°„ìœ¼ë¡œ ë³€í™”ë¥¼ ê°ì§€í•  ìˆ˜ ìˆë„ë¡ TanStack Queryë¥¼ ì‚¬ìš©í•´ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™€ ë³€í™”ê°€ ë°œìƒí•˜ë©´ `invalidateQueries`ë¥¼ í†µí•´ ë³€ê²½ëœ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ë„ë¡ í•©ë‹ˆë‹¤.

```tsx
// ./src/components/features/mypage/EditProfileModal.tsx

const EditProfileModal = ({
  user,
  setShowModal
}: {
  user: User | undefined;
  setShowModal: React.Dispatch<React.SetStateAction<boolean>>;
}) => {
  ...
  // ì‚¬ìš©ì í”„ë¡œí•„ ì—…ë°ì´íŠ¸ ì‹œ ì •ë³´ ë°”ë¡œ ê°±ì‹ ë˜ë„ë¡
  const queryClient = useQueryClient();
  // ì‚¬ìš©ì ì •ë³´ ì—…ë°ì´íŠ¸ ì„±ê³µ ì‹œ invalidateQueries
  const { mutate: handleUpdateUser } = useMutation({
    mutationFn: () => updateUser(user as User, nickname, profileImg),
    onSuccess: () => {
      queryClient.invalidateQueries({
        queryKey: ["user", "client"]
      });
      queryClient.invalidateQueries({ queryKey: ["post", currentUserId] });
      queryClient.invalidateQueries({ queryKey: ["posts"] });
    }
  });
  ...
};


```

---

[ë„¤ë¹„ê²Œì´ì…˜ ë°”]

ë¡œê·¸ì¸ ì •ë³´ê°€ ì—†ì„ ì‹œ íšŒì›ê°€ì…, ë¡œê·¸ì¸ ë²„íŠ¼ì´ ìš°ì¸¡ ìƒë‹¨ì— ìœ„ì¹˜í•˜ë©°, ë¡œê·¸ì¸ ì •ë³´ê°€ ìˆì„ ì‹œ ë¡œê·¸ì•„ì›ƒ, ë§ˆì´í˜ì´ì§€ ë²„íŠ¼ê³¼ í”„ë¡œí•„ ì´ë¯¸ì§€ê°€ ìš°ì¸¡ ìƒë‹¨ì— ìœ„ì¹˜í•©ë‹ˆë‹¤.

1. Link íƒœê·¸ë¡œ ì—°ê²°í•˜ì—¬ í˜ì´ì§€ ë¡œë”© ìµœì í™”

í˜ì´ì§€ ì •ë³´ë¥¼ ë¯¸ë¦¬ ë¶ˆëŸ¬ì™€ì„œ ì´ë™ ì‹œ ì‹œê°„ì„ ì¤„ì¼ ìˆ˜ ìˆë„ë¡ í–ˆìŠµë‹ˆë‹¤.

```tsx
// ./src/components/features/navbar/ProfileImg.tsx

const ProfileImg = () => {
  ...
  const userImg = getPublicUrl("profiles", user?.user_metadata.profile_img);

  return (
    <Link href={"/mypage"} className="min-w-fit min-h-fit rounded-full">
      <Image
        src={userImg}
        alt="í”„ë¡œí•„ ì´ë¯¸ì§€"
        width={40}
        height={40}
        className="w-[40px] h-[40px] border-2 rounded-full aspect-auto object-cover"
      />
    </Link>
  );
};
```

---

---

## ğŸ’¥ Trouble Shooting

[íšŒì›ê°€ì…/ë¡œê·¸ì¸]

ğŸ”¥ ë¡œê·¸ì•„ì›ƒ í•´ë„ 'ë¡œê·¸ì•„ì›ƒ, ë§ˆì´í˜ì´ì§€' ë²„íŠ¼ì´ ìœ ì§€ë¨.

ì„œë²„ìš©/í´ë¼ì´ì–¸íŠ¸ìš© supabase clientë¥¼ ì œëŒ€ë¡œ ìˆ™ì§€í•˜ì§€ ëª»í•´, supabase clientê°€ ì œëŒ€ë¡œ ì‘ë™í•˜ì§€ ì•Šì•„ ì‚¬ìš©ì ì •ë³´ê°€ ì—…ë°ì´íŠ¸ ë˜ì§€ ì•Šì•„ ë°œìƒí•œ ë¬¸ì œì˜€ìŠµë‹ˆë‹¤.

ì„œë²„ìš© supabase clientë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” ê° í•¨ìˆ˜ë§ˆë‹¤ clientë¥¼ ìƒì„±í•˜ê³ , í´ë¼ì´ì–¸íŠ¸ìš© supabase clientëŠ” í•˜ë‚˜ì˜ clientë§Œ ìƒì„±í•´ importí•˜ì—¬ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.

```tsx
// ./src/utils/supabase/server-action.ts

"use server";
...
import { createClient } from "./server";

export async function signin(formData: SignInWithPasswordCredentials) {
  const supabase = createClient();
  ...
}

export async function signup(formData: SignUpWithPasswordCredentials) {
  const supabase = createClient();
  ...
}

export async function signout() {
  const supabase = createClient();
  ...
}

...

```

```tsx
// ./src/utils/supabase/server.tsx

import { createBrowserClient } from "@supabase/ssr";

export function createClient() {
  return createBrowserClient(process.env.NEXT_PUBLIC_SUPABASE_URL!, process.env.NEXT_PUBLIC_SUPABASE_KEY!);
}

export const supabase = createClient();
```

ğŸ”¥ íšŒì›ê°€ì…/ë¡œê·¸ì¸ ì‹œ ìœ íš¨ì„± ê²€ì‚¬ì— ì‚¬ìš©í•  í…Œì´ë¸”ì´ ì—†ì—ˆìŒ.

`email` ì»¬ëŸ¼ ê°’ì„ uniqueí•˜ê²Œ ì„¤ì •í•˜ê¸° ìœ„í•´ ëª¨ë“  ì‚¬ìš©ìë¥¼ ì§€ìš°ëŠ” ê³¼ì •ì´ í•„ìš”í–ˆìŠµë‹ˆë‹¤. ë©ë‹¬ì•„ ì—°ê²°ëœ ì •ë³´ë„ ê°™ì´ ì‚¬ë¼ì§€ê²Œ ë˜ì–´ ê²°êµ­ ëª¨ë“  ë°ì´í„°ë¥¼ ì§€ìš¸ ìˆ˜ ë°–ì— ì—†ì—ˆìŠµë‹ˆë‹¤.

ì¢€ ë” ìì„¸íˆ ìƒê°í•˜ê³  ë°ì´í„° ë² ì´ìŠ¤ë¥¼ ì„¤ê³„í•´ì•¼ í•œë‹¤ëŠ” ê²ƒì„ ë°°ì› ìŠµë‹ˆë‹¤.

---

[í”Œë ˆì´ì–´]

---

[ê²€ìƒ‰]

---

[ê²Œì‹œê¸€]

---

[ëŒ“ê¸€]

ğŸ”¥ ë¬¸ì œì <br>
ëŒ“ê¸€ ì‘ì„± ì‹œ ì‹œê°„ì´ ë¡œì»¬ê³¼ ë‹¤ë¥´ê²Œ í‘œì‹œë˜ëŠ” ë¬¸ì œ
ëŒ“ê¸€ì„ ì‘ì„±í•˜ë©´ í‘œì‹œë˜ëŠ” ì‹œê°„ì´ ì‹¤ì œ ë¡œì»¬ ì‹œê°„ê³¼ ì¼ì¹˜í•˜ì§€ ì•ŠëŠ” ë¬¸ì œê°€ ìˆì—ˆìŠµë‹ˆë‹¤. Supabaseê°€ ê¸°ë³¸ì ìœ¼ë¡œ UTC ì‹œê°„ì„ ì‚¬ìš©í•´ ë°ì´í„°ë¥¼ ì €ì¥í•˜ê¸° ë•Œë¬¸ì— ë°œìƒí•œ ë¬¸ì œì˜€ìŠµë‹ˆë‹¤.

í•´ê²°<br>
ëŒ“ê¸€ ì‘ì„± ì‹œê°„ì„ í‘œì‹œí•  ë•Œ ë¡œì»¬ ì‹œê°„ëŒ€ë¡œ ë³€í™˜í•˜ëŠ” formatDate í•¨ìˆ˜ë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. toLocaleString()ì„ ì‚¬ìš©í•˜ì—¬ í•œêµ­ í‘œì¤€ì‹œ(KST)ë¡œ ë³€í™˜í•˜ì—¬ í‘œì‹œí–ˆìŠµë‹ˆë‹¤.

---

[ë§ˆì´í˜ì´ì§€]

ğŸ”¥ ë‹¤ë¥¸ ì‚¬ìš©ìë¡œ ë¡œê·¸ì¸í•˜ë©´ ê¸°ì¡´ ì‚¬ìš©ì ì •ë³´ê°€ ë§ˆì´ í˜ì´ì§€ ì‚¬ìš©ì ì •ë³´ì— ì ìš©ë¨.

TanStack Queryë¥¼ ì‚¬ìš©í•´ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™€ì„œ auth stateê°€ ë³€ê²½ë˜ë©´ `invalidateQueries`ë¥¼ ì‹¤í–‰í•¨. ì´ë•Œ í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ì—ì„œë§Œ TanStack Queryë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆê³ , í•­ìƒ ìƒë‹¨ì— ë…¸ì¶œë˜ì–´ìˆëŠ” client ì»´í¬ë„ŒíŠ¸ê°€ ë„¤ë¹„ê²Œì´ì…˜ ë°”ì˜ í”„ë¡œí•„ ì´ë¯¸ì§€ì´ë¯€ë¡œ í•´ë‹¹ ì»´í¬ë„ŒíŠ¸ì— `onAuthStateChange`ë¥¼ ì ìš©í•¨.

```tsx
// ./xrc/components/features/navbar/ProfileImg.tsx

const ProfileImg = () => {
  ...
  supabase.auth.onAuthStateChange(() => {
    // ëª¨ë“  auth state ë³€í™”ì— ë”°ë¼ session ë‹¤ì‹œ ì €ì¥
    queryClient.invalidateQueries({ queryKey: ["user", "client"] });
  });
  ...
};
```

---

[ë„¤ë¹„ê²Œì´ì…˜ ë°”]

ğŸ”¥ ì‚¬ìš©ì ì •ë³´ ë³€ê²½ ì‹œ í”„ë¡œí•„ ì´ë¯¸ì§€ê°€ ê°™ì´ ë°˜ì˜ë˜ì§€ ì•ŠìŒ

TanStack Queryì˜ Provider ë‚´ë¶€ì— í—¤ë”ë¥¼ í¬í•¨ì‹œì¼œ `invalidateQueries`ì˜ ì˜í–¥ì„ ë°›ë„ë¡ í•¨.

```tsx
// ./src/app/layout.tsx

export default async function RootLayout({
  children
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en" suppressHydrationWarning>
      <body className={`${geistSans.variable} ${geistMono.variable} antialiased flex flex-col min-h-screen`}>
        <Providers>
          <Header />
          <Background>{children}</Background>
          <Footer />
        </Providers>
      </body>
    </html>
  );
}
```

```tsx
// ./xrc/components/features/navbar/ProfileImg.tsx

const ProfileImg = () => {
  const defaultImg = getPublicUrl("profiles", "default");

  const {
    data: user,
    isLoading,
    isError
  } = useQuery({
    queryKey: ["user", "client"],
    queryFn: () => fetchSessionData()
  });

  supabase.auth.onAuthStateChange(() => {
    // ëª¨ë“  auth state ë³€í™”ì— ë”°ë¼ session ë‹¤ì‹œ ì €ì¥
    queryClient.invalidateQueries({ queryKey: ["user", "client"] });
  });
  ...
};
```

---
