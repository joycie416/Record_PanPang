# ë ˆì½”ë“œíŒ¡íŒ¡ ğŸ­ [Record PanPang]

## ğŸ”— ë°°í¬ ë§í¬

---

## ğŸ‘¨â€ğŸ« í”„ë¡œì íŠ¸ ì†Œê°œ

ì¼ìƒê³¼ ê¸°ë¶„ì„ ê³µìœ í•˜ë©° ë…¸ë˜ë¥¼ ì¶”ì²œí•˜ëŠ” ë‰´ìŠ¤í”¼ë“œ ì‚¬ì´íŠ¸ì…ë‹ˆë‹¤. ì‚¬ìš©ìë“¤ì´ ìì‹ ì˜ ê°ì •ê³¼ ìˆœê°„ì„ ë…¸ë˜ì™€ í•¨ê»˜ í‘œí˜„í•  ìˆ˜ ìˆëŠ” ê³µê°„ì„ ì œê³µí•©ë‹ˆë‹¤.

## ğŸš© í”„ë¡œì íŠ¸ ê°œìš”

- **í”„ë¡œì íŠ¸ëª…** &nbsp; :&nbsp; **Record PanPang**
- **ì§„í–‰ ê¸°ê°„** &nbsp;: &nbsp; **24.10.10 ~ 24.10.17**

---

## â¤ íŒ€ ì†Œê°œ

[ë‚´ì¼ë°°ì›€ìº í”„] 2ì¡°

## ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ íŒ€ì› ì†Œê°œ

|  ì†¡ì§„ìš°   |     ì´ë³´ì˜     |        ì •ìˆ˜í¬         |   ì¡°ì•„ì˜    |            ì¡°í•´ì¸            |
| :-------: | :------------: | :-------------------: | :---------: | :--------------------------: |
| **íŒ€ì›**  |    **íŒ€ì›**    |       **íŒ€ì›**        |  **íŒ€ì›**   |           **íŒ€ì¥**           |
| ëŒ“ê¸€ ì „ë°˜ | ìŒì•… ê²€ìƒ‰ ê¸°ëŠ¥ | ìŒì•… í”Œë ˆì´ì–´, ì¢‹ì•„ìš” | ê²Œì‹œê¸€ ì „ë°˜ | íšŒì›ê°€ì…/ë¡œê·¸ì¸, í”„ë¡œí•„ ìˆ˜ì • |

---

## ğŸ“š STACKS

![js](https://img.shields.io/badge/JavaScript-F7DF1E?style=for-the-badge&logo=JavaScript&logoColor=white)
![html](https://img.shields.io/badge/HTML-239120?style=for-the-badge&logo=html5&logoColor=white)
![css](https://img.shields.io/badge/CSS-239120?&style=for-the-badge&logo=css3&logoColor=white)
![Next.js](https://img.shields.io/badge/Next.js-000?logo=nextdotjs&logoColor=fff&style=for-the-badge)
![React](https://img.shields.io/badge/React-20232A?style=for-the-badge&logo=react&logoColor=61DAFB)
![TypeScript](https://img.shields.io/badge/TypeScript-007ACC?style=for-the-badge&logo=typescript&logoColor=white)
![Tailwind_CSS](https://img.shields.io/badge/Tailwind_CSS-38B2AC?style=for-the-badge&logo=tailwind-css&logoColor=white)
![Git](https://img.shields.io/badge/Git-F05032?style=for-the-badge&logo=Git&logoColor=white)
![Github](https://img.shields.io/badge/GitHub-181717?style=for-the-badge&logo=GitHub&logoColor=white)
![Zustand](https://img.shields.io/badge/Zustand-666666?style=for-the-badge)
![TanStack Query](https://img.shields.io/badge/TanStack_Query-666666?style=for-the-badge)
![Visual Studio Code](https://img.shields.io/badge/Visual%20Studio%20Code-007ACC?style=for-the-badge&logo=Visual%20Studio%20Code&logoColor=white)
![eslint](https://img.shields.io/badge/eslint-3A33D1?style=for-the-badge&logo=eslint&logoColor=white)
![prettier](https://img.shields.io/badge/prettier-1A2C34?style=for-the-badge&logo=prettier&logoColor=F7BA3E)
![Vercel](https://img.shields.io/badge/Vercel-000000?style=for-the-badge&logo=vercel&logoColor=white)
![Figma](https://img.shields.io/badge/Figma-F24E1E?style=for-the-badge&logo=figma&logoColor=white)
![Notion](https://img.shields.io/badge/Notion-000000?style=for-the-badge&logo=notion&logoColor=white)
![Slack](https://img.shields.io/badge/Slack-4A154B?style=for-the-badge&logo=slack&logoColor=white)

---

## âœ”ï¸ ì„¤ì¹˜ íŒ¨í‚¤ì§€

- í”„ë¡œì íŠ¸ ì„¸íŒ… : npx create-next-app@latest
  - tailwindcss í¬í•¨
  - ì‹¤í–‰ : yarn dev
- tanstack query ì„¤ì¹˜ : yarn add @tanstack/react-query
  - tailwind.config.js íŒŒì¼ ìƒì„± : npx tailwindcss init -p
- zustand ì„¤ì¹˜ : yarn add zustand
- zod ì„¤ì¹˜ : yarn add zod
- react-hook-form ì„¤ì¹˜ : yarn add react-hook-form @hookform/resolvers
- shadcn/ui(ìºëŸ¬ì…€ ë¼ì´ë¸ŒëŸ¬ë¦¬) : yarn add shadcn/ui
  - gray, cssVariables X

## âœ”ï¸ Code Convention

- ES Lint , prettier ì‚¬ìš©
- ì»´í¬ë„ŒíŠ¸ì¼ ê²½ìš°ì—ë§Œ .jsxí™•ì¥ì ì‚¬ìš©
- customHookì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš° : use + í•¨ìˆ˜ëª…
- Propsì˜ ê²½ìš°: on (onClick ë“±ë“±)
- í•¨ìˆ˜ì¸ ê²½ìš°: handle (handleClick ë“±ë“±)
- ìƒìˆ˜ : ëª¨ë‘ ëŒ€ë¬¸ì ìŠ¤ë„¤ì´í¬ ì¼€ì´ìŠ¤(snake_case) ì˜ˆì‹œ) SNAKE_CASE
- js(ë³€ìˆ˜, í•¨ìˆ˜, ì¸ìŠ¤í„´ìŠ¤) : ì¹´ë©œ ì¼€ì´ìŠ¤(camelCase) ì˜ˆì‹œ) const createMovie = [];
- css, html : ì¼€ë°¥ ì¼€ì´ìŠ¤(kebab-case) ì˜ˆì‹œ)Â `<div class="movie-items"></div>`
- image ëª… : ì¼€ë°¥ ì¼€ì´ìŠ¤(kebab-case) ì˜ˆì‹œ) movie-img.jpg
- ì£¼ì„ ìµœëŒ€í•œ í™œìš©í•˜ê¸° : í•´ë‹¹ ì½”ë“œ ì œëª©, ì„¤ëª… ê°„ë‹¨í•˜ê²Œ ì ì–´ë†“ê¸°
- ì•½ì¹­ì€ ë˜ë„ë¡ ì‚¬ìš©í•˜ì§€ ì•Šê¸°

## âœ”ï¸ Git Commit Convention

**ì‘ì—… íƒ€ì… ì‘ì—…ë‚´ìš©**

- update : í•´ë‹¹ íŒŒì¼ì— ìƒˆë¡œìš´ ê¸°ëŠ¥ì´ ìƒê¹€
- add : ì—†ë˜ íŒŒì¼ì„ ìƒì„±í•¨, ì´ˆê¸° ì„¸íŒ…
- bugfix : ë²„ê·¸ ìˆ˜ì •
- refactor : ì½”ë“œ ë¦¬íŒ©í† ë§
- fix : ì½”ë“œ ìˆ˜ì •
- move : íŒŒì¼ ì˜®ê¹€/ì •ë¦¬
- del : ê¸°ëŠ¥/íŒŒì¼ì„ ì‚­ì œ
- test : í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±
- style : css
- gitfix : gitignore ìˆ˜ì •
- script : package.json ë³€ê²½(npm ì„¤ì¹˜ ë“±)

---

## ğŸ“¦ í”„ë¡œì íŠ¸ íŒŒì¼ êµ¬ì¡°

<details>
  <summary><b>Record PanPang íŒŒì¼ êµ¬ì¡°</b></summary>

```
 â”£ ğŸ“‚src
 â”ƒ â”£ ğŸ“‚app
 â”ƒ â”ƒ â”£ ğŸ“‚(assets)
 â”ƒ â”ƒ â”ƒ â”£ ğŸ“œEmptyHeart.tsx
 â”ƒ â”ƒ â”ƒ â”£ ğŸ“œFillHeart.tsx
 â”ƒ â”ƒ â”ƒ â”£ ğŸ“œPauseCon.tsx
 â”ƒ â”ƒ â”ƒ â”£ ğŸ“œPlayCon.tsx
 â”ƒ â”ƒ â”ƒ â”— ğŸ“œStopCon.tsx
 â”ƒ â”ƒ â”£ ğŸ“‚api
 â”ƒ â”ƒ â”ƒ â”— ğŸ“œspotifyToken.ts
 â”ƒ â”ƒ â”£ ğŸ“‚detail
 â”ƒ â”ƒ â”ƒ â”— ğŸ“‚[id]
 â”ƒ â”ƒ â”ƒ â”ƒ â”— ğŸ“œpage.tsx
 â”ƒ â”ƒ â”£ ğŸ“‚fonts
 â”ƒ â”ƒ â”ƒ â”£ ğŸ“œPretendard.subset.woff
 â”ƒ â”ƒ â”ƒ â”— ğŸ“œPretendard.subset.woff2
 â”ƒ â”ƒ â”£ ğŸ“‚mypage
 â”ƒ â”ƒ â”ƒ â”— ğŸ“œpage.tsx
 â”ƒ â”ƒ â”£ ğŸ“‚sign-in
 â”ƒ â”ƒ â”ƒ â”£ ğŸ“œerror.tsx
 â”ƒ â”ƒ â”ƒ â”— ğŸ“œpage.tsx
 â”ƒ â”ƒ â”£ ğŸ“‚sign-up
 â”ƒ â”ƒ â”ƒ â”£ ğŸ“œerror.tsx
 â”ƒ â”ƒ â”ƒ â”— ğŸ“œpage.tsx
 â”ƒ â”ƒ â”£ ğŸ“‚write
 â”ƒ â”ƒ â”ƒ â”£ ğŸ“‚[id]
 â”ƒ â”ƒ â”ƒ â”ƒ â”— ğŸ“œpage.tsx
 â”ƒ â”ƒ â”ƒ â”— ğŸ“œpage.tsx
 â”ƒ â”ƒ â”£ ğŸ“œglobals.css
 â”ƒ â”ƒ â”£ ğŸ“œlayout.tsx
 â”ƒ â”ƒ â”— ğŸ“œpage.tsx
 â”ƒ â”£ ğŸ“‚components
 â”ƒ â”ƒ â”£ ğŸ“‚commonUI
 â”ƒ â”ƒ â”ƒ â”£ ğŸ“œLikeButton.tsx
 â”ƒ â”ƒ â”ƒ â”— ğŸ“œPostCard.tsx
 â”ƒ â”ƒ â”£ ğŸ“‚features
 â”ƒ â”ƒ â”ƒ â”£ ğŸ“‚auth
 â”ƒ â”ƒ â”ƒ â”ƒ â”£ ğŸ“œauthForm.tsx
 â”ƒ â”ƒ â”ƒ â”ƒ â”— ğŸ“œsignOutButton.tsx
 â”ƒ â”ƒ â”ƒ â”£ ğŸ“‚comment
 â”ƒ â”ƒ â”ƒ â”ƒ â”£ ğŸ“œCommentInput.tsx
 â”ƒ â”ƒ â”ƒ â”ƒ â”£ ğŸ“œCommentItem.tsx
 â”ƒ â”ƒ â”ƒ â”ƒ â”£ ğŸ“œCommentList.tsx
 â”ƒ â”ƒ â”ƒ â”ƒ â”— ğŸ“œCommentSection.tsx
 â”ƒ â”ƒ â”ƒ â”£ ğŸ“‚mypage
 â”ƒ â”ƒ â”ƒ â”ƒ â”£ ğŸ“œEditProfileButton.tsx
 â”ƒ â”ƒ â”ƒ â”ƒ â”£ ğŸ“œeditProfileModal.tsx
 â”ƒ â”ƒ â”ƒ â”ƒ â”£ ğŸ“œMyComment.tsx
 â”ƒ â”ƒ â”ƒ â”ƒ â”£ ğŸ“œMyLike.tsx
 â”ƒ â”ƒ â”ƒ â”ƒ â”£ ğŸ“œMyPageTabs.tsx
 â”ƒ â”ƒ â”ƒ â”ƒ â”£ ğŸ“œMyPost.tsx
 â”ƒ â”ƒ â”ƒ â”ƒ â”£ ğŸ“œprofile.tsx
 â”ƒ â”ƒ â”ƒ â”ƒ â”£ ğŸ“œProfileError.tsx
 â”ƒ â”ƒ â”ƒ â”ƒ â”— ğŸ“œProfileLoading.tsx
 â”ƒ â”ƒ â”ƒ â”£ ğŸ“‚navbar
 â”ƒ â”ƒ â”ƒ â”ƒ â”£ ğŸ“œFooter.tsx
 â”ƒ â”ƒ â”ƒ â”ƒ â”£ ğŸ“œHeader.tsx
 â”ƒ â”ƒ â”ƒ â”ƒ â”— ğŸ“œProfileImg.tsx
 â”ƒ â”ƒ â”ƒ â”£ ğŸ“‚player
 â”ƒ â”ƒ â”ƒ â”ƒ â”£ ğŸ“œDetailPlayButton.tsx
 â”ƒ â”ƒ â”ƒ â”ƒ â”£ ğŸ“œDetailPlayer.tsx
 â”ƒ â”ƒ â”ƒ â”ƒ â”£ ğŸ“œPlayButton.tsx
 â”ƒ â”ƒ â”ƒ â”ƒ â”£ ğŸ“œPlayer.tsx
 â”ƒ â”ƒ â”ƒ â”ƒ â”— ğŸ“œPlayIcon.tsx
 â”ƒ â”ƒ â”ƒ â”£ ğŸ“‚post
 â”ƒ â”ƒ â”ƒ â”ƒ â”£ ğŸ“œPostButtons.tsx
 â”ƒ â”ƒ â”ƒ â”ƒ â”£ ğŸ“œPostForm.tsx
 â”ƒ â”ƒ â”ƒ â”ƒ â”£ ğŸ“œPostList.tsx
 â”ƒ â”ƒ â”ƒ â”ƒ â”— ğŸ“œPostSection.tsx
 â”ƒ â”ƒ â”ƒ â”— ğŸ“‚spotifySearch
 â”ƒ â”ƒ â”ƒ â”ƒ â”— ğŸ“œpage.tsx
 â”ƒ â”ƒ â”£ ğŸ“‚providers
 â”ƒ â”ƒ â”ƒ â”— ğŸ“œQueryClientProvider.tsx
 â”ƒ â”ƒ â”— ğŸ“‚ui
 â”ƒ â”ƒ â”ƒ â”£ ğŸ“œbutton.tsx
 â”ƒ â”ƒ â”ƒ â”£ ğŸ“œcard.tsx
 â”ƒ â”ƒ â”ƒ â”£ ğŸ“œcommand.tsx
 â”ƒ â”ƒ â”ƒ â”£ ğŸ“œdialog.tsx
 â”ƒ â”ƒ â”ƒ â”£ ğŸ“œinput.tsx
 â”ƒ â”ƒ â”ƒ â”— ğŸ“œtextarea.tsx
 â”ƒ â”£ ğŸ“‚hook
 â”ƒ â”ƒ â”£ ğŸ“œusePostById.ts
 â”ƒ â”ƒ â”£ ğŸ“œusePostByUserId.ts
 â”ƒ â”ƒ â”— ğŸ“œusePosts.ts
 â”ƒ â”£ ğŸ“‚lib
 â”ƒ â”ƒ â”— ğŸ“œutils.ts
 â”ƒ â”£ ğŸ“‚store
 â”ƒ â”ƒ â”£ ğŸ“œplayerStore.tsx
 â”ƒ â”ƒ â”— ğŸ“œspotifyStore.tsx
 â”ƒ â”£ ğŸ“‚types
 â”ƒ â”ƒ â”£ ğŸ“œauth.ts
 â”ƒ â”ƒ â”£ ğŸ“œcomment.ts
 â”ƒ â”ƒ â”£ ğŸ“œpost.ts
 â”ƒ â”ƒ â”£ ğŸ“œSpotify.ts
 â”ƒ â”ƒ â”— ğŸ“œtrack.ts
 â”ƒ â”£ ğŸ“‚utils
 â”ƒ â”ƒ â”£ ğŸ“‚supabase
 â”ƒ â”ƒ â”ƒ â”£ ğŸ“œclient-actions.ts
 â”ƒ â”ƒ â”ƒ â”£ ğŸ“œclient.tsx
 â”ƒ â”ƒ â”ƒ â”£ ğŸ“œmiddleware.ts
 â”ƒ â”ƒ â”ƒ â”£ ğŸ“œserver-actions.ts
 â”ƒ â”ƒ â”ƒ â”— ğŸ“œserver.tsx
 â”ƒ â”ƒ â”£ ğŸ“œformatTrackData.ts
 â”ƒ â”ƒ â”£ ğŸ“œgetYoutubeID.ts
 â”ƒ â”ƒ â”£ ğŸ“œspotify-client.ts
 â”ƒ â”ƒ â”— ğŸ“œspotify-server.ts
 â”ƒ â”— ğŸ“œmiddleware.ts
 â”£ ğŸ“œ.env.local
 â”£ ğŸ“œ.eslintrc.json
 â”£ ğŸ“œ.gitignore
 â”£ ğŸ“œ.prettierrc
 â”£ ğŸ“œcomponents.json
 â”£ ğŸ“œnext-env.d.ts
 â”£ ğŸ“œnext.config.mjs
 â”£ ğŸ“œpackage-lock.json
 â”£ ğŸ“œpackage.json
 â”£ ğŸ“œpostcss.config.mjs
 â”£ ğŸ“œREADME.md
 â”£ ğŸ“œtailwind.config.ts
 â”£ ğŸ“œtsconfig.json
 â”— ğŸ“œyarn.lock
```

</details>
<br/>

## ğŸ“‹ Supabase ERD ì„¤ê³„ë„

---

## ğŸ—‚ï¸ ê¸°ëŠ¥ ì„¤ëª…

### íšŒì›ê°€ì…/ë¡œê·¸ì¸

Supabase Authë¥¼ ì‚¬ìš©í•´ ê´€ë¦¬í–ˆìŠµë‹ˆë‹¤.

1. ìœ íš¨ì„± ê²€ì‚¬ - 1
   ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ìœ„í•´ `zod`ì™€ `react-hook-form`ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ì¡´ì¬í•˜ëŠ” ì´ë©”ì¼ì€ ë³„ë„ì˜ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ í†µí•´ ì•Œë ¤ì¤ë‹ˆë‹¤.

```tsx
// ./src/components/auth/Auth

const AuthForm = () => {
  ...
  const schema =
    path === SIGN_UP
      ? z.object({
          email: z
            .string()
            .email({ message: "ì´ë©”ì¼ í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”" })
            .min(1, { message: "ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" }),
          password: z.string().min(6, "6ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”"),
          nickname: z.string().min(1, "ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.").max(10, "ìµœëŒ€ 10ì ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.")
        })
      : z.object({
          email: z.string().min(1, "ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"),
          password: z.string().min(1, "ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”")
        });
  ...
  const { register, handleSubmit, formState } = useForm({
    mode: "onChange", //'onBlur' : focusê°€ ì‚¬ë¼ì¡Œì„ ë•Œ
    defaultValues,
    resolver: zodResolver(schema)
  });
  ...
  return (
    <div className="container modal">
      <form onSubmit={handleSubmit(onSubmit)} className="p-4 flex flex-col items-center m-auto">
        <Input
          {...register("email")}
          placeholder="email"
          className={AUTH_CSS}
          onChange={() => setEmailMessage("")}
        />
        {formState.errors.email && <span className="text-sky-300 leading-tight">{formState.errors.email.message}</span>}
        {!!emailMessage && <span className="text-sky-300 leading-tight">{emailMessage}</span>}

        ...

      </form>
    <div className="embla" ref={emblaRef}>
      <div className="embla__container">
        {carousel &&
          [0, 2, 4, 6].map(
            (
              i // ê° ìŠ¬ë¼ì´ë“œì— ë‘ê°œì”© ë³´ì—¬ì¤Œ
            ) => <Slide play={[carousel[i], carousel[i + 1]]} key={`slide-${i}`} />
          )}
      </div>
    </div>
  );
};
```

2. ìœ íš¨ì„± ê²€ì‚¬ - 2
   `profiles` í…Œì´ë¸”ì— ì €ì¥ëœ `email`ì„ ë¶ˆëŸ¬ì™€ì„œ í•´ë‹¹ ì´ë©”ì¼ì´ ì¡´ì¬í•˜ëŠ” í™•ì¸í•©ë‹ˆë‹¤.

```tsx
// ./src/components/auth/Auth

const AuthForm = () => {
  ...
  const { register, handleSubmit, formState } = useForm({
    mode: "onChange", //'onBlur' : focusê°€ ì‚¬ë¼ì¡Œì„ ë•Œ
    defaultValues,
    resolver: zodResolver(schema)
  });
  ...
  const onSubmit = async (data: FieldValues) => {
    const emailData = await checkEmail(data.email);

    if (path === SIGN_UP) {
      if (emailData.length !== 0) {
        setEmailMessage("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ê³„ì •ì…ë‹ˆë‹¤.");
      } else {
        await signup({
          email: data.email,
          password: data.password,
          options: { data: { nickname: data.nickname, email: data.email, profile_img: "default" } }
        });
      }
    } else {
      if (emailData.length === 0) {
        setEmailMessage("ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê³„ì •ì…ë‹ˆë‹¤.");
      } else {
        await signin({ email: data.email, password: data.password });
      }
    }
  };
  ...
};
```

```tsx
// ./src/utils/supabase/client-actions.ts

export async function checkEmail(email: string) {
  const { data, error } = await supabase.from(PROFILES).select("email").eq("email", email);

  if (error) {
    console.error(error);
    return [];
  }

  return data;
}
```

<br />

### í”Œë ˆì´ì–´

```tsx

```

<br />

### ê²€ìƒ‰

```tsx

```

<br />

### ê²Œì‹œê¸€

ê²Œì‹œê¸€ ëª©ë¡ì„ TanStack Queryë¥¼ ì´ìš©í•˜ì—¬ ì‹¤ì‹œê°„ìœ¼ë¡œ ë°˜ì˜ë˜ë„ë¡ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.<br />
ì´ ê¸°ëŠ¥ì„ í†µí•´ ì‚¬ìš©ìëŠ” ê²Œì‹œê¸€ì´ ì¶”ê°€, ìˆ˜ì •, ì‚­ì œë  ë•Œ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ëœ ë‚´ìš©ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```tsx
// PostList.tsx
const PostList = ({ user, token }: Props) => {
  // ê²Œì‹œê¸€ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” í›… í˜¸ì¶œ
  const { data: posts, isLoading, isError } = usePosts();

  if (isLoading) {
    return <div>Loading...</div>;
  }
  if (isError) {
    return <div>ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>;
  }
  if (!posts) {
    return <div>ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</div>;
  }

  return (
    <ul className="flex flex-col gap-6">
      {posts.map((post) => (
        <li key={post.post_id}>
          {/* ê° ê²Œì‹œê¸€ì„ PostCard ì»´í¬ë„ŒíŠ¸ë¡œ ë Œë”ë§ */}
          <PostCard post={post} user={user} token={token} />
        </li>
      ))}
    </ul>
  );
};

// usePosts.ts
export const usePosts = () => {
  return useQuery({
    queryKey: ["posts"], // ì¿¼ë¦¬ í‚¤
    queryFn: fetchPosts // ë°ì´í„° ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
  });
};

// client-actions.ts
export async function fetchPosts() {
  // posts í…Œì´ë¸”ì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
  const { data: posts, error: postsError } = await supabase
    .from("posts")
    .select("*, profiles(nickname, profile_img)") // í”„ë¡œí•„ ë°ì´í„° í¬í•¨
    .order("created_at", { ascending: false }); // ìµœì‹  ê²Œì‹œê¸€ ìš°ì„  ì •ë ¬

  // ì—ëŸ¬ ë°œìƒ ì‹œ ì²˜ë¦¬
  if (postsError || !posts) {
    console.error(postsError);
    return []; // ì—ëŸ¬ ë°œìƒ ì‹œ ë¹ˆ ë°°ì—´ ë°˜í™˜
  }

  // ê²°ê³¼ì—ì„œ ê° í¬ìŠ¤íŠ¸ì˜ í”„ë¡œí•„ ë°ì´í„° ì¶”ê°€
  return posts.map((post) => ({
    ...post
  }));
}
```

<br/>

### ëŒ“ê¸€

```tsx

```

<br />

### ë§ˆì´í˜ì´ì§€

ì‚¬ìš©ì ì •ë³´ì™€ ì‚¬ìš©ìê°€ ì‘ì„±í•œ ê²Œì‹œê¸€ê³¼ ëŒ“ê¸€, ì¢‹ì•„ìš”í•œ ê²Œì‹œê¸€ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

1. í”„ë¡œí•„ ìˆ˜ì • ê¸°ëŠ¥
   `í”„ë¡œí•„ ìˆ˜ì •í•˜ê¸°` ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ëª¨ë‹¬ì°½ì„ í†µí•´ ì‚¬ìš©ì ì •ë³´ë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
   ì‹¤ì‹œê°„ìœ¼ë¡œ ë³€í™”ë¥¼ ê°ì§€í•  ìˆ˜ ìˆë„ë¡ TanStack Queryë¥¼ ì‚¬ìš©í•´ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™€ ë³€í™”ê°€ ë°œìƒí•˜ë©´ `invalidateQueries`ë¥¼ í†µí•´ ë³€ê²½ëœ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ë„ë¡ í•©ë‹ˆë‹¤.

```tsx
// ./src/components/features/mypage/EditProfileModal.tsx

const EditProfileModal = ({
  user,
  setShowModal
}: {
  user: User | undefined;
  setShowModal: React.Dispatch<React.SetStateAction<boolean>>;
}) => {
  ...
  // ì‚¬ìš©ì í”„ë¡œí•„ ì—…ë°ì´íŠ¸ ì‹œ ì •ë³´ ë°”ë¡œ ê°±ì‹ ë˜ë„ë¡
  const queryClient = useQueryClient();
  // ì‚¬ìš©ì ì •ë³´ ì—…ë°ì´íŠ¸ ì„±ê³µ ì‹œ invalidateQueries
  const { mutate: handleUpdateUser } = useMutation({
    mutationFn: () => updateUser(user as User, nickname, profileImg),
    onSuccess: () => {
      queryClient.invalidateQueries({
        queryKey: ["user", "client"]
      });
      queryClient.invalidateQueries({ queryKey: ["post", currentUserId] });
      queryClient.invalidateQueries({ queryKey: ["posts"] });
    }
  });
  ...
};
```

<br />

### ë„¤ë¹„ê²Œì´ì…˜ ë°”

ë¡œê·¸ì¸ ì •ë³´ê°€ ì—†ì„ ì‹œ íšŒì›ê°€ì…, ë¡œê·¸ì¸ ë²„íŠ¼ì´ ìš°ì¸¡ ìƒë‹¨ì— ìœ„ì¹˜í•˜ë©°, ë¡œê·¸ì¸ ì •ë³´ê°€ ìˆì„ ì‹œ ë¡œê·¸ì•„ì›ƒ, ë§ˆì´í˜ì´ì§€ ë²„íŠ¼ê³¼ í”„ë¡œí•„ ì´ë¯¸ì§€ê°€ ìš°ì¸¡ ìƒë‹¨ì— ìœ„ì¹˜í•©ë‹ˆë‹¤.

1. Link íƒœê·¸ë¡œ ì—°ê²°í•˜ì—¬ í˜ì´ì§€ ë¡œë”© ìµœì í™”

í˜ì´ì§€ ì •ë³´ë¥¼ ë¯¸ë¦¬ ë¶ˆëŸ¬ì™€ì„œ ì´ë™ ì‹œ ì‹œê°„ì„ ì¤„ì¼ ìˆ˜ ìˆë„ë¡ í–ˆìŠµë‹ˆë‹¤.

```tsx
// ./src/components/features/navbar/ProfileImg.tsx

const ProfileImg = () => {
  ...
  const userImg = getPublicUrl("profiles", user?.user_metadata.profile_img);

  return (
    <Link href={"/mypage"} className="min-w-fit min-h-fit rounded-full">
      <Image
        src={userImg}
        alt="í”„ë¡œí•„ ì´ë¯¸ì§€"
        width={40}
        height={40}
        className="w-[40px] h-[40px] border-2 rounded-full aspect-auto object-cover"
      />
    </Link>
  );
};
```

---

## ğŸ’¥ Trouble Shooting

### íšŒì›ê°€ì…/ë¡œê·¸ì¸

ğŸ”¥ ë¡œê·¸ì•„ì›ƒ í•´ë„ 'ë¡œê·¸ì•„ì›ƒ, ë§ˆì´í˜ì´ì§€' ë²„íŠ¼ì´ ìœ ì§€ë¨.

ì„œë²„ìš©/í´ë¼ì´ì–¸íŠ¸ìš© supabase clientë¥¼ ì œëŒ€ë¡œ ìˆ™ì§€í•˜ì§€ ëª»í•´, supabase clientê°€ ì œëŒ€ë¡œ ì‘ë™í•˜ì§€ ì•Šì•„ ì‚¬ìš©ì ì •ë³´ê°€ ì—…ë°ì´íŠ¸ ë˜ì§€ ì•Šì•„ ë°œìƒí•œ ë¬¸ì œì˜€ìŠµë‹ˆë‹¤.

ì„œë²„ìš© supabase clientë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” ê° í•¨ìˆ˜ë§ˆë‹¤ clientë¥¼ ìƒì„±í•˜ê³ , í´ë¼ì´ì–¸íŠ¸ìš© supabase clientëŠ” í•˜ë‚˜ì˜ clientë§Œ ìƒì„±í•´ importí•˜ì—¬ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.

```tsx
// ./src/utils/supabase/server-action.ts

"use server";
...
import { createClient } from "./server";

export async function signin(formData: SignInWithPasswordCredentials) {
  const supabase = createClient();
  ...
}

export async function signup(formData: SignUpWithPasswordCredentials) {
  const supabase = createClient();
  ...
}

export async function signout() {
  const supabase = createClient();
  ...
}
...
```

```tsx
// ./src/utils/supabase/server.tsx

import { createBrowserClient } from "@supabase/ssr";

export function createClient() {
  return createBrowserClient(process.env.NEXT_PUBLIC_SUPABASE_URL!, process.env.NEXT_PUBLIC_SUPABASE_KEY!);
}

export const supabase = createClient();
```

ğŸ”¥ íšŒì›ê°€ì…/ë¡œê·¸ì¸ ì‹œ ìœ íš¨ì„± ê²€ì‚¬ì— ì‚¬ìš©í•  í…Œì´ë¸”ì´ ì—†ì—ˆìŒ.

`email` ì»¬ëŸ¼ ê°’ì„ uniqueí•˜ê²Œ ì„¤ì •í•˜ê¸° ìœ„í•´ ëª¨ë“  ì‚¬ìš©ìë¥¼ ì§€ìš°ëŠ” ê³¼ì •ì´ í•„ìš”í–ˆìŠµë‹ˆë‹¤. ë©ë‹¬ì•„ ì—°ê²°ëœ ì •ë³´ë„ ê°™ì´ ì‚¬ë¼ì§€ê²Œ ë˜ì–´ ê²°êµ­ ëª¨ë“  ë°ì´í„°ë¥¼ ì§€ìš¸ ìˆ˜ ë°–ì— ì—†ì—ˆìŠµë‹ˆë‹¤.

ì¢€ ë” ìì„¸íˆ ìƒê°í•˜ê³  ë°ì´í„° ë² ì´ìŠ¤ë¥¼ ì„¤ê³„í•´ì•¼ í•œë‹¤ëŠ” ê²ƒì„ ë°°ì› ìŠµë‹ˆë‹¤.
<br />
<br />

### í”Œë ˆì´ì–´

```tsx

```

<br />

### ê²€ìƒ‰

```tsx

```

<br />

### ê²Œì‹œê¸€

**Supabase ì™¸ë˜í‚¤ ì—°ê²°**

- **ë¬¸ì œ ë°œìƒ:** `posts` í…Œì´ë¸”ì—ì„œ `post_id`ë¡œ `user_id`ë¥¼ ì°¾ì•„ `profiles` í…Œì´ë¸”ì—ì„œ `nickname`, `profile_img` ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ë ¤ í–ˆìŠµë‹ˆë‹¤. ì•„ë˜ ì½”ë“œì™€ ê°™ì´ ì‘ì„±í•˜ê³  Supabaseì—ì„œ ì™¸ë˜í‚¤ ì—°ê²°ì„ ì‹œë„í–ˆì§€ë§Œ ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. 'insert or update on table "posts" violates foreign key constraint "posts_user_id_fkey"'ì˜¤ë¥˜ëŠ” `posts` í…Œì´ë¸”ì˜ `user_id` í•„ë“œê°€ `profiles` í…Œì´ë¸”ì˜ `user_id`ì™€ ì™¸ë˜í‚¤ë¡œ ì—°ê²°ë˜ì–´ ìˆëŠ”ë°, ì‚½ì…í•˜ë ¤ëŠ” `user_id` ê°’ì´ `profiles` í…Œì´ë¸”ì— ì¡´ì¬í•˜ì§€ ì•Šê±°ë‚˜ ìœ íš¨í•˜ì§€ ì•Šì€ ê²½ìš° ì´ ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤.
- **í•´ê²° ë°©ë²•:** ë‘ í…Œì´ë¸” ê°„ì˜ ì—°ê²°ì— ë¬¸ì œê°€ ìˆëŠ” ê²ƒìœ¼ë¡œ ì¶”ì¸¡ë˜ì–´, ê¸°ì¡´ì— ë“±ë¡ëœ ë°ì´í„°ë¥¼ ëª¨ë‘ ì‚­ì œí•œ í›„ ì™¸ë˜í‚¤ë¥¼ ë‹¤ì‹œ ì—°ê²°í–ˆìŠµë‹ˆë‹¤.

```tsx
// post_idë¡œ ê²Œì‹œê¸€ ì •ë³´ ì¡°íšŒ
export async function getPostById(postId: string) {
  const { data, error } = await supabase
    .from("posts")
    .select("*, profiles(nickname, profile_img)")
    .eq("post_id", postId)
    .single();

  if (error || !data) {
    console.error(error);
    return null;
  }

  return data;
}
```

<br />

### ëŒ“ê¸€

```tsx

```

<br />

### ë§ˆì´í˜ì´ì§€

ğŸ”¥ ë‹¤ë¥¸ ì‚¬ìš©ìë¡œ ë¡œê·¸ì¸í•˜ë©´ ê¸°ì¡´ ì‚¬ìš©ì ì •ë³´ê°€ ë§ˆì´ í˜ì´ì§€ ì‚¬ìš©ì ì •ë³´ì— ì ìš©ë¨.

TanStack Queryë¥¼ ì‚¬ìš©í•´ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™€ì„œ auth stateê°€ ë³€ê²½ë˜ë©´ `invalidateQueries`ë¥¼ ì‹¤í–‰í•¨. ì´ë•Œ í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ì—ì„œë§Œ TanStack Queryë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆê³ , í•­ìƒ ìƒë‹¨ì— ë…¸ì¶œë˜ì–´ìˆëŠ” client ì»´í¬ë„ŒíŠ¸ê°€ ë„¤ë¹„ê²Œì´ì…˜ ë°”ì˜ í”„ë¡œí•„ ì´ë¯¸ì§€ì´ë¯€ë¡œ í•´ë‹¹ ì»´í¬ë„ŒíŠ¸ì— `onAuthStateChange`ë¥¼ ì ìš©í•¨.

```tsx
// ./xrc/components/features/navbar/ProfileImg.tsx

const ProfileImg = () => {
  ...
  supabase.auth.onAuthStateChange(() => {
    // ëª¨ë“  auth state ë³€í™”ì— ë”°ë¼ session ë‹¤ì‹œ ì €ì¥
    queryClient.invalidateQueries({ queryKey: ["user", "client"] });
  });
  ...
};
```

<br />

### ë„¤ë¹„ê²Œì´ì…˜ ë°”

ğŸ”¥ ì‚¬ìš©ì ì •ë³´ ë³€ê²½ ì‹œ í”„ë¡œí•„ ì´ë¯¸ì§€ê°€ ê°™ì´ ë°˜ì˜ë˜ì§€ ì•ŠìŒ

TanStack Queryì˜ Provider ë‚´ë¶€ì— í—¤ë”ë¥¼ í¬í•¨ì‹œì¼œ `invalidateQueries`ì˜ ì˜í–¥ì„ ë°›ë„ë¡ í•¨.

```tsx
// ./src/app/layout.tsx

export default async function RootLayout({
  children
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en" suppressHydrationWarning>
      <body className={`${geistSans.variable} ${geistMono.variable} antialiased flex flex-col min-h-screen`}>
        <Providers>
          <Header />
          <Background>{children}</Background>
          <Footer />
        </Providers>
      </body>
    </html>
  );
}
```

```tsx
// ./xrc/components/features/navbar/ProfileImg.tsx

const ProfileImg = () => {
  const defaultImg = getPublicUrl("profiles", "default");

  const {
    data: user,
    isLoading,
    isError
  } = useQuery({
    queryKey: ["user", "client"],
    queryFn: () => fetchSessionData()
  });

  supabase.auth.onAuthStateChange(() => {
    // ëª¨ë“  auth state ë³€í™”ì— ë”°ë¼ session ë‹¤ì‹œ ì €ì¥
    queryClient.invalidateQueries({ queryKey: ["user", "client"] });
  });
  ...
};
```
